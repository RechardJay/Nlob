---
title: "辨析：分布式与微服务"
date: "2025-10-16"
tags: "技术"
---

# 到底什么是分布式系统？

想象一下，如果一个任务非常繁重，一个人（一台计算机）干不完或者干得太慢，怎么办？

最直观的想法是：**找一群人来一起干**。

这就是分布式系统的核心思想。即多台机器协作，对应单体即一台机器。

举个例子？不用举了，你访问的任何一个网站，游戏，App，这些网络服务器背后都是一个庞大的分布式系统。

# 微服务和分布式的关系？

这是最容易混淆的一对概念。它们不是同一维度的东西，而是**一种实现与一种架构风格**的关系。

### 微服务是一种**架构风格**

微服务核心思想是：**把一个大一统的（单体）应用，按照业务领域拆分成一系列小的、自治的服务。**

- **关注点**：如何拆分应用、如何组织代码、如何管理团队。

- **核心特征**：

  - **服务围绕业务能力构建**：比如用户服务、订单服务、商品服务。

  - **去中心化治理**：每个服务可以用不同的技术栈（Java, Go, Python）。

  - **独立部署**：可以单独升级和发布用户服务，而不影响订单服务。

  - **轻量级通信**：服务之间通过 API（通常是 HTTP/REST 或 RPC）进行通信。

### 分布式是一种**系统形态**

分布式系统描述的是：**系统的组件在物理上是如何部署和交互的。**

- **关注点**：如何解决由于物理分离（网络）带来的问题，如一致性、容错、通信、可扩展性。

### 交集与依赖

- **分布式系统** 就像 **“一个团队协作干活”**。

- **微服务架构** 就像 **“把一个大项目拆分成多个小模块，分给团队里不同小组去完成”**。

**关系梳理**：

1. **微服务架构天然是分布式的**：
当你把一个单体应用拆分成多个微服务时，这些服务必须部署在不同的进程、甚至不同的机器上。它们通过网络进行通信，这就**必然**形成了一个分布式系统。所以，**所有的微服务架构都是分布式系统**。

1. **但分布式系统不一定是微服务架构**：

  - 一个庞大的、没有拆分的一体化软件（单体应用），为了应对高并发，也可以部署在多台机器上，前面用负载均衡器分发请求。这同样是一个分布式系统（因为组件分布在多台机器上协作），但它不是微服务架构。

  - Kafka、Redis、HDFS 这些中间件本身是分布式系统，又与其他组件协作构成了一个更大的分布式系统，但它们不是微服务。

总结：

- **分布式系统**：一个宏观概念，指“多台计算机协作”这个事实。**（是什么？）**

- **注册中心、消息队列等组件**：是构建分布式系统的基础设施，本身也是一个分布式系统。

- **微服务**：是一种设计和构建应用（尤其是业务系统）的**具体方法**，这种方法天然地依赖于、并创造了一个分布式系统。**（怎么设计应用？）**

# 分布式系统有哪些组件

一提起分布式就容易想到微服务，进而想到SpringCloud，Zookeeper体系里的各种组件。但这样并不全面，宏观来讲，任何后端应用和应用都可以分布式的方式部署调用（但没必要）。而微服务体系天然是分布式的，这就导致了概念的混淆。实际上对于分布式系统，我们可以将其组件分为两大类：**核心基础设施组件**和**业务架构组件**。

## 一、 核心基础设施组件

这些是分布式系统的“骨架”和“神经系统”，为上层应用提供通用的、与业务无关的支撑能力。

### 1. 注册中心-服务注册与发现

- **功能**：解决“服务在哪里”的问题。服务实例启动时向中心注册自己的网络地址（IP和端口），消费方通过查询中心来发现目标服务的地址列表。

- **常用工具**：

  - **Nacos**：功能全面，支持服务和配置管理。

  - **Consul**：基于CP，提供强一致性的服务发现和健康检查。

  - **Zookeeper**：经典的CP系统，通过ZooKeeper的临时节点实现服务注册和发现。

  - **etcd**：Kubernetes的核心，一个高可用的键值存储，常用于服务发现。

### 2. 配置中心-全局变量

- **功能**：解决“配置如何集中、动态管理”的问题。将所有服务的配置集中存储和管理，实现配置的动态推送和版本控制，无需重启服务。

- **常用工具**：**Nacos**， **Apollo**， **Spring Cloud Config**， **Consul**。

### 3. API 网关

- **功能**：系统的统一入口，就像公司的前台。

  - **路由转发**：将请求路由到正确的后端服务。

  - **认证鉴权**：统一进行身份验证和权限检查。

  - **限流熔断**：防止恶意流量打垮后端服务。

  - **日志监控**：收集入口流量日志。

  - **负载均衡**：在多个服务实例间分发请求。

- **常用工具**：**Spring Cloud Gateway**， **Kong**， **APISIX**。

### 4. 消息队列

- **功能**：系统的“主动脉”，负责解耦、异步和削峰填谷。

  - **解耦**：服务A发消息，无需关心谁消费。

  - **异步**：服务A发完消息即可返回，无需等待处理完成。

  - **削峰**：应对突发流量，保护后端系统。

- **常用工具**：**Kafka**（高吞吐、日志场景）， **RabbitMQ**（功能丰富、协议支持多）， **RocketMQ**（金融级、事务消息）。

### 5. 分布式缓存

- **功能**：解决“热点数据访问性能”和“数据库压力”问题。将数据存储在内存中，提供极快的读写速度。

- **常用工具**：**Redis**（绝对主流）， **Memcached**（更简单，仅支持KV）。

### 6. 分布式数据存储

- **功能**：解决海量数据的存储和访问问题。

  - **关系型数据库（分布式）**：**TiDB**， **OceanBase**， **CockroachDB**。提供SQL接口和水平扩展能力。

  - **NoSQL数据库**：

    - **键值型**：**Redis**

    - **文档型**：**MongoDB**（灵活的JSON结构）

    - **列族型**：**HBase**， **Cassandra**（适合海量写入和查询）

    - **搜索型**：**Elasticsearch**（全文检索和复杂聚合）

### 7. 协调与分布式锁

- **功能**：在分布式环境下协调多个节点的行为，保证一致性。例如，实现分布式锁、选举主节点、维护集群元数据。

- **常用工具**：**Zookeeper**， **etcd**。它们基于Paxos或Raft等一致性算法，提供强一致性的小文件存储。

## 二、 业务架构与高阶组件

这些组件构建在基础设施之上，这些组件用于解决更复杂的问题。即系统的“高可用”。

### 8. 容错与流量治理

- **功能**：解决“服务挂了或响应慢怎么办”的问题，保证系统整体的韧性。

  - **熔断**：当下游服务失败率达到阈值时，自动切断请求，防止雪崩。

  - **降级**：在系统压力过大时，关闭非核心功能，保证核心流程畅通。

  - **限流**：控制单位时间内的请求量，保护系统。

  - **负载均衡**：在服务实例间智能分发请求。

- **常用工具**：**Sentinel**， **Hystrix**，以及**服务网格**。

### 9. 可观测性套件

- **功能**：解决“系统内部发生了什么”的问题，是运维和调试的“眼睛”。

  - **日志**：**ELK/EFK Stack**（Elasticsearch, Logstash/Fluentd, Kibana）。

  - **指标**：**Prometheus**（监控指标采集和存储） + **Grafana**（指标可视化）。

  - **链路追踪**：**SkyWalking**， **Zipkin**， **Jaeger**。用于追踪一个请求穿过所有微服务的完整路径和性能瓶颈。

### 10. 任务调度

- **功能**：解决“分布式环境下定时任务如何不重复、不遗漏执行”的问题。

- **常用工具**：**XXL-Job**， **Elastic-Job**， **Quartz**（集群模式）。

### 11. 服务网格

- **功能**：将**流量治理**（熔断、限流、路由、安全）等能力从应用程序代码中剥离出来，作为一个独立的**基础设施层**，通过Sidecar代理（如Envoy）来管理服务间的通信。

- **常用工具**：**Istio**， **Linkerd**。

# 碎碎念

在技术里纠结概念没啥意义，这些概念本身就有交叉，有太多中间地带不能严格划分，比如MySQL算分布式组件吗？平常交流随口说也都习惯了。我们确实不在意这些123，但真要聊起来，脑子里也不能一团浆糊啊。